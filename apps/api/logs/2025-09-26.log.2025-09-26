2025-09-26 13:00:54 | ERROR | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x10587f6b0>>
Traceback (most recent call last):
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1136, in do_terminate
    dbapi_connection.terminate()
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 907, in terminate
    self.await_(asyncio.shield(self._connection.close(timeout=2)))
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 1467, in close
    await self._protocol.close(timeout)
  File "asyncpg/protocol/protocol.pyx", line 626, in close
  File "asyncpg/protocol/protocol.pyx", line 659, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 1611, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/.pyenv/versions/3.12.5/lib/python3.12/asyncio/base_events.py", line 456, in create_task
    self._check_closed()
  File "/Users/oferiko/.pyenv/versions/3.12.5/lib/python3.12/asyncio/base_events.py", line 541, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-09-26 17:38:26 | INFO | app | Server started successfully
2025-09-26 17:38:27 | INFO | app | Starting up...
2025-09-26 17:38:57 | WARNING | app | [401] TokenInvalidError: Not authenticated, please login first
2025-09-26 17:39:15 | WARNING | app | [401] InvalidCredentialsError: Invalid email or password
2025-09-26 17:40:09 | WARNING | app | [401] TokenInvalidError: Not authenticated, please login first
2025-09-26 17:41:58 | INFO | app | notif.skip_no_recipients
2025-09-26 17:42:03 | INFO | app | notif.skip_no_recipients
2025-09-26 17:42:08 | INFO | app | notif.skip_no_recipients
2025-09-26 18:09:41 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 18:49:59 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 18:50:06 | ERROR | app | Unhandled exception occurred
Traceback (most recent call last):
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 305, in connect_check_health
    await self.retry.call_with_retry(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/retry.py", line 50, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 760, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/.pyenv/versions/3.12.5/lib/python3.12/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 2043, in create_connection
  File "uvloop/loop.pyx", line 2020, in uvloop.loop.Loop.create_connection
ConnectionRefusedError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/api/routes/v1/row_route.py", line 35, in update_row
    return await row_service.update_row(row_id, table_id, current_user.id, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/api/services/row_service.py", line 90, in update_row
    await self.notification_service.emit_row_updated(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/notification_service.py", line 56, in emit_row_updated
    await self._emit_events(db, str(table.board_id), actor_id, actor_name, [event])
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/notification_service.py", line 124, in _emit_events
    await emit_activity(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/emitter.py", line 46, in emit_activity
    await pipe.execute()
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/client.py", line 1590, in execute
    conn = await self.connection_pool.get_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 1182, in ensure_connection
    await connection.connect()
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 61 connecting to localhost:6379. Connection refused.
2025-09-26 18:50:18 | ERROR | app | Unhandled exception occurred
Traceback (most recent call last):
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 305, in connect_check_health
    await self.retry.call_with_retry(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/retry.py", line 50, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 760, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/.pyenv/versions/3.12.5/lib/python3.12/asyncio/streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 2043, in create_connection
  File "uvloop/loop.pyx", line 2020, in uvloop.loop.Loop.create_connection
ConnectionRefusedError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/api/routes/v1/row_route.py", line 35, in update_row
    return await row_service.update_row(row_id, table_id, current_user.id, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/api/services/row_service.py", line 90, in update_row
    await self.notification_service.emit_row_updated(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/notification_service.py", line 56, in emit_row_updated
    await self._emit_events(db, str(table.board_id), actor_id, actor_name, [event])
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/notification_service.py", line 124, in _emit_events
    await emit_activity(
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/app/notification/emitter.py", line 46, in emit_activity
    await pipe.execute()
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/client.py", line 1590, in execute
    conn = await self.connection_pool.get_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 1182, in ensure_connection
    await connection.connect()
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
  File "/Users/oferiko/Developer/personal/unicorn/apps/api/.venv/lib/python3.12/site-packages/redis/asyncio/connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 61 connecting to localhost:6379. Connection refused.
2025-09-26 15:52:03 | INFO | app | Starting up...
2025-09-26 15:52:34 | INFO | app | Starting up...
2025-09-26 15:53:25 | WARNING | app | [401] TokenInvalidError: User not found
2025-09-26 15:59:59 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 15:59:59 | WARNING | app | [401] RefreshTokenExpiredError: Refresh token is invalid or expired
2025-09-26 16:02:20 | INFO | app | notif.skip_no_recipients
2025-09-26 16:08:08 | INFO | app | notif.skip_no_recipients
2025-09-26 16:08:17 | INFO | app | notif.skip_no_recipients
2025-09-26 16:08:21 | INFO | app | notif.skip_no_recipients
2025-09-26 17:54:59 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 18:28:58 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 19:24:57 | WARNING | app | [401] AccessTokenExpiredError: Expired token
2025-09-26 22:16:34 | ERROR | app | [404] HTTPException: Not Found
2025-09-26 23:12:30 | ERROR | app | [404] HTTPException: Not Found
2025-09-27 10:02:07 | INFO | app | Shutting down...
2025-09-27 10:02:07 | INFO | app | Application shutdown complete.
